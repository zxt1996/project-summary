# 管理后台
## 1.设置代理
在config/config.ts中设置,后面的数据请求时用到

```
proxy: {
    '/apis/': {
      target: '这里填入你要代理的url,后台提供',
      changeOrigin: true, // pathRewrite: { '^/server': '' },
    },
  },
```

## 2.路由设置

也在config/config.ts中设置

```
routes: [
    {
      path: '/user',
      component: '../layouts/UserLayout',
      routes: [
        {
          name: 'login',
          path: '/user/login',
          component: './user/login',
        },
      ],
    },
]
```

## 3.在src/pages中编写相应的页面

## 4.dva状态管理
### 编写service文件
用来进行接口请求

```
import request from '../../../utils/request';

// 获取官网活动
//params用于设置请求头参数
const getactive = (activename) => {
    return request.get('/websiteActivity/get-website-activities',{
        params: {
            "name":activename
        },
    });
}

// 新增活动
//data用于设置请求体中的参数
const moreactive = (data) => {
    request.post('/websiteActivity/add-website-activity',{
        data:data
    })
}

export {
    getactive,
    moreactive,
}
```

### 编写model文件
这里类似于redux的作用  

1. namespace:相当于该model在整个文件中的唯一标识符
2. state:数据存储
3. effects:进行异步请求,在拿到数据后,把数据传给reducers进行管理
4. reducers:相当于redux中的功能,进行数据的管理,通过用户dispatch操作返回相应的数据

```
import {getactive,
        moreactive,} from './service';

export default {
    namespace:'officialactive',
    state:{
        list:[]
    },
    effects:{
        // 获取列表数据
        /**
        * @param payload 参数
        * @param call 执行异步函数调用接口
        * @param put 发出一个 Action，类似于 dispatch 将服务端返回的数据传递给上面的state
        **/ 
        *fetchactive({payload},{call,put}){
            const response = yield call(getactive,payload);
            // console.log(response.data.webActivities);
            yield put({
                //这行对应reducers处理函数名字
                type:'activeget',
                // 将最后的处理数据传递给reducers函数
                payload:response
            })
        },
        // 新增活动
        *formoreactive({payload},{call,put}){
            yield call(moreactive,payload);
            yield put({
                type:'fetchactive'
            })
        },
    },
    reducers:{
        activeget(state,action){
            return {
                ...state,
                list:[...action.payload.data.webActivities]
            }
        }
    }
}
```

## 5.在页面中引入数据
通过dva提供的**connect**来做state和dispatch的映射

```
import { connect } from 'dva';

const Grayscale = ({mygray,getgraylist,postgraylist}) => {
    useEffect(() => {
        getgraylist();
    }, []);

    //将state中的数据传入useEffect的第二个参数来实时渲染页面
    useEffect(() => {
        // console.log(mygray.list);
        if(mygray && mygray.list){
        console.log(mygray.list)
        setdata(mygray.list);
        }
    }, [mygray]);
}

export default connect(
  state => ({
    mygray:state.gray
  }),
  dispatch => ({
    getgraylist : () => dispatch({
      type:'gray/fetchgray'
    }),
    postgraylist: (data) => dispatch({
      type:'gray/postmygray',
      payload:data
    })
  })
)(Grayscale);
```